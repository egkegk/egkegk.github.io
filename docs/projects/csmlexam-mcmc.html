<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emrys King">
<meta name="dcterms.date" content="2025-12-12">

<title>MCMC Sampling from a Multimodal Density – Emrys King</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-65d202d7ace8b1f7d0f702f72208ab20.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../logo.png" alt="A hypercube logo." class="navbar-logo light-content">
    <img src="../logo.png" alt="A hypercube logo." class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Emrys King</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text"> </span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#random-walk-metropolis-hastings" id="toc-random-walk-metropolis-hastings" class="nav-link active" data-scroll-target="#random-walk-metropolis-hastings">Random Walk Metropolis-Hastings</a></li>
  <li><a href="#random-walk-metropolis-hastings-with-a-variable-transformation" id="toc-random-walk-metropolis-hastings-with-a-variable-transformation" class="nav-link" data-scroll-target="#random-walk-metropolis-hastings-with-a-variable-transformation">Random Walk Metropolis-Hastings with a Variable Transformation</a></li>
  <li><a href="#parallel-tempering" id="toc-parallel-tempering" class="nav-link" data-scroll-target="#parallel-tempering">Parallel Tempering</a></li>
  <li><a href="#comparison-of-algorithms" id="toc-comparison-of-algorithms" class="nav-link" data-scroll-target="#comparison-of-algorithms">Comparison of Algorithms</a></li>
  <li><a href="#confidence-intervals-using-mcmc-samplers" id="toc-confidence-intervals-using-mcmc-samplers" class="nav-link" data-scroll-target="#confidence-intervals-using-mcmc-samplers">Confidence Intervals using MCMC Samplers</a></li>
  <li><a href="#sec-code" id="toc-sec-code" class="nav-link" data-scroll-target="#sec-code">Code Appendix</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MCMC Sampling from a Multimodal Density</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emrys King </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    In this report, I build MCMC samplers to approximate a multimodal density. I use a simple Random Walk Metropolis-Hastings (RWMH) algorithm, a variable-transformed RWMH algorithm, and a parallel tempering algorithm. The efficacy of each method is compared, and the samplers are used to generate confidence intervals for the expectation of a random variable with the given density.
  </div>
</div>


</header>


<p>Let <span class="math inline">\(f(x) = k(\exp[-3(x-2)]+\exp[-(x-30)^2]+\exp[-(x-20)^2/0.01])\mathbf{1}_{\{x\geq 2\}}\)</span> be the target density with normalising constant <span class="math inline">\(k &gt;0\)</span> and support <span class="math inline">\(x\geq 2\)</span>.</p>
<section id="random-walk-metropolis-hastings" class="level2">
<h2 class="anchored" data-anchor-id="random-walk-metropolis-hastings">Random Walk Metropolis-Hastings</h2>
<p>First, I will sample from the target distribution using random walk Metropolis-Hastings (RWMH) with random noise <span class="math inline">\(\xi\sim \mathcal{N}(0,\sigma^2)\)</span>. The target density is clearly multimodal, with modes at <span class="math inline">\(x=2,20,30\)</span>. This means that small <span class="math inline">\(\sigma\)</span> will result in the the Markov chain failing to explore the entirety of the distribution, as it will gravitate towards the nearest mode from the initial chain value <span class="math inline">\(X_0\)</span>. Furthermore, the scaling factor of <span class="math inline">\(1/0.01\)</span> for the mode at <span class="math inline">\(X = 20\)</span> causes that mode to be a less ``weighty” attractor for the chain than the other modes. For a demonstration of these phenomena, see <a href="#fig-q1a-1" class="quarto-xref">Figure&nbsp;1</a>, which generates <span class="math inline">\(n=200,000\)</span> samples with the random noise’s standard deviation set to <span class="math inline">\(\sigma=0.5\)</span>. Disregarding initial burn-in, the starting value of <span class="math inline">\(X\)</span> determines the mode around which the chain explores. Furthermore, it is clear that the scaling factor of the mode at <span class="math inline">\(X=20\)</span> greatly weakens its influence on the likelihood, as shown by the starting value <span class="math inline">\(X_0=15\)</span> travelling to the mode at <span class="math inline">\(X=2\)</span> instead of <span class="math inline">\(X=20\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-q1a-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q1a-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-q1a-1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q1a-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Traceplots of four implementations of a random walk Metropolis-Hastings algorithm with normal noise. All implementations use <span class="math inline">\(n=200,000\)</span> and <span class="math inline">\(\sigma=0.5\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>This is clearly an issue. To create an effective sampler, the Markov chain must explore the all parts of the distribution, regardless of the initial value. In a multimodal target density such as this, that equates to mixing (or, convergence to the <em>full</em> stationary distribution), which is not present when <span class="math inline">\(\sigma=0.5\)</span>.</p>
<p>To evaluate the sampler’s convergence to the stationary distribution I use the Gelman and Rubin diagnostic, <span class="math inline">\(\hat R\)</span>, with 6 independent chains (i.e., twice the number of modes). Since <span class="math inline">\(\sigma=0.5\)</span> clearly was too small a standard deviation to allow full exploration, I repeated the process of creating chains and evaluating their <span class="math inline">\(\hat R\)</span> for integer values of <span class="math inline">\(\sigma\geq 1\)</span> until the sampler seemed suitably near convergence. To generate <span class="math inline">\(\hat R\)</span>, multiple chains are needed; I constructed 6 chains with start values <span class="math inline">\(\mathbf{X_0}=(2,20,30,2,20,30)\)</span> for each value of <span class="math inline">\(\sigma\)</span>. The diagnostic plots are shown in <a href="#fig-q1a-2" class="quarto-xref">Figure&nbsp;2</a>. From these iterations we can see that the distribution certainly converges when <span class="math inline">\(\sigma=6\)</span> (for some seeds it will converge for smaller <span class="math inline">\(\sigma\)</span>, but this is not generalisable). To avoid unnecessary increased variance, I do not consider random walk samplers for values of <span class="math inline">\(\sigma &gt; 6\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-q1a-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q1a-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-q1a-2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q1a-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: <span class="math inline">\(\hat R\)</span> diagnostic plots for the RWMH algorithm with <span class="math inline">\(\sigma\)</span> at varying levels.
</figcaption>
</figure>
</div>
</div>
</div>
<p>However, such a high variance comes at a cost: the mixing is very slow due to the high autocorrelation of the samples. As shown in <a href="#fig-q1a-acf" class="quarto-xref">Figure&nbsp;3</a>, it takes a lag several thousand samples for the autocorrelation to reach 0, which is a sizeable percentage of the number of generated samples. Thus, even though we have a sampler that converges to the stationary distribution, its mixing quality is exceptionally poor.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-q1a-acf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q1a-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-q1a-acf-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q1a-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Autocorrelation of a RWMH chain with <span class="math inline">\(n=200,000\)</span>, <span class="math inline">\(X_0=15\)</span>, and <span class="math inline">\(\sigma=6\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="random-walk-metropolis-hastings-with-a-variable-transformation" class="level2">
<h2 class="anchored" data-anchor-id="random-walk-metropolis-hastings-with-a-variable-transformation">Random Walk Metropolis-Hastings with a Variable Transformation</h2>
<p>The support of <span class="math inline">\(f(x)\)</span> is <span class="math inline">\([2,\infty)\)</span>, but the random walk Metropolis-Hastings algorithm detailed above can propose values less than 2. Thus, to only propose values within the support of the target density, we need to apply variable transformation. I chose the transformation <span class="math inline">\(y =h^{-1}(x)= \log (x-2)\)</span>, which is defined on <span class="math inline">\([2,\infty)\)</span>. This results in <span class="math inline">\(x=h(y)=e^y+2\)</span>, with <span class="math inline">\(|J_g(y)|=e^y\)</span>. Therefore, we may sample from <span class="math inline">\(g(y)\)</span> instead, for <span class="math inline">\(g\)</span> defined as: <span class="math display">\[
g(y) = f(e^y+2)e^y=k'e^y(\exp[-3(e^y)]+\exp[-(e^y-28)^2]+\exp[-(e^y-18)^2/0.01])
\]</span> where <span class="math inline">\(k'&gt;0\)</span> is an unknown normalisation constant.</p>
<p>We may implement a random walk Metropolis-Hastings sampler for <span class="math inline">\(g\)</span> much the same way we did for <span class="math inline">\(f\)</span>, being sure to transform the sampled values at the end to return values of <span class="math inline">\(x\)</span>, not <span class="math inline">\(y\)</span>. The sampler also needs to take an input value in terms of <span class="math inline">\(y\)</span>, not <span class="math inline">\(x\)</span>. I chose a start value of <span class="math inline">\(Y_0=\log(13)\)</span>, equivalent to <span class="math inline">\(X_0=15\)</span>. I tested the algorithm for several values of <span class="math inline">\(\sigma\)</span> to see its convergence and mixing quality, similarly to the investigation in part (a), before deciding on <span class="math inline">\(\sigma=2\)</span>, a much lower variance (and therefore faster mixing) but with similar convergence to <span class="math inline">\(\sigma=6\)</span> in (a) above.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-q1b-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q1b-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-q1b-1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q1b-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: A traceplot for the variable-transformed RWMH sampler, run for <span class="math inline">\(n=200,000\)</span> iterations with <span class="math inline">\(\sigma = 3\)</span> and <span class="math inline">\(Y_0 = 0\)</span> (or, <span class="math inline">\(X_0=2\)</span>).
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in <a href="#fig-q1b-1" class="quarto-xref">Figure&nbsp;4</a>, the variable-transformed random walk Metropolis-Hastings converges to the target distribution.</p>
</section>
<section id="parallel-tempering" class="level2">
<h2 class="anchored" data-anchor-id="parallel-tempering">Parallel Tempering</h2>
<p>We will now use a parallel tempering algorithm to sample from <span class="math inline">\(f\)</span>. The algorithm I implemented has the structure shown in <a href="#alg-parallel" class="quarto-xref">alg.&nbsp;1</a>, where <span class="math inline">\(n\)</span> is the number of iterations, <span class="math inline">\(\mathbf{T} = (T_1, T_2,\dots, T_M)\)</span> is the vector of temperatures, <span class="math inline">\(\sigma = (\sigma_1,\sigma_2,\dots,\sigma_M)\)</span> is the vector of standard deviations for each tempered chain, <span class="math inline">\(\mathbf{X_0}= (X_{0,1}, X_{0,2},\dots,X_{0,M})\)</span> is the vector of initial values, and <span class="math inline">\(X_{i,j}\)</span> denotes the <span class="math inline">\(i\)</span>th sample of the <span class="math inline">\(j\)</span>th tempered chain. I implemented the algorithm for <span class="math inline">\(n=200,000\)</span> iterations on <span class="math inline">\(M=5\)</span> chains with temperatures <span class="math inline">\(\mathbf{T} = (1, 5, 7, 10, 15)\)</span>, standard deviations <span class="math inline">\(\sigma = (0.5, 0.7, 0.8, 0.9, 1)\)</span>, and initial values <span class="math inline">\(\mathbf{X_0}=(15,15,15,15,15)\)</span>. The transition kernels used for the ``<span class="math inline">\(X\)</span>-step” are <span class="math inline">\(N(X_{i-1,j}, \sigma_j^2)\)</span>, as stated in line 5 of <a href="#alg-parallel" class="quarto-xref">alg.&nbsp;1</a>.</p>
<p>This algorithm will allow the chains to explore the distribution widely, while constraining the variance of the true sampling chain <span class="math inline">\(T_1\)</span> to <span class="math inline">\(0.5\)</span>, greatly speeding up the mixing of the sampler. We see in <a href="#fig-q1c-traceplot" class="quarto-xref">Figure&nbsp;5</a> that this increase in mixing quality does not come at the expense of convergence: the sampler is exploring the distribution fully and correctly.</p>
<div id="alg-parallel" class="theorem algorithm">
<p><span class="theorem-title"><strong>Algorithm 1</strong></span> &nbsp;</p>
<div style="border: 1px solid #333; padding: 15px; background-color: #f9f9f9; font-family: monospace;">
<p><strong>Algorithm 1: Parallel Tempering Algorithm</strong></p>
<table style="border: none; width: 100%;">
<tbody><tr>
<td style="border: none;">
<strong>Procedure</strong> ParallelTempering(<span class="math inline">\(n, \mathbf{T}, \boldsymbol{\sigma}^{2}, \mathbf{X_0}\)</span>)
</td>
</tr>
<tr>
<td style="border: none; padding-left: 20px;">
<strong>for</strong> <span class="math inline">\(i = 1, 2, \dots, n\)</span> <strong>do</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 40px;">
<strong>Procedure</strong> X-Step()
</td>
</tr>
<tr>
<td style="border: none; padding-left: 60px;">
<strong>for</strong> <span class="math inline">\(j = 1, 2, \dots, M\)</span> <strong>do</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 80px;">
generate <span class="math inline">\(Y \sim N(X_{i-1, j}, \sigma_{j}^2)\)</span>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 80px;">
generate <span class="math inline">\(u \sim U([0,1])\)</span>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 80px;">
<strong>if</strong> <span class="math inline">\(u \leq \left(\frac{f(Y)}{f(X_{i-1,j})}\right)^{\frac{1}{T_j}}\)</span> <strong>then</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 100px;">
<span class="math inline">\(X_{i,j} = Y\)</span>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 80px;">
<strong>else</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 100px;">
<span class="math inline">\(X_{i,j} = X_{i-1,j}\)</span>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 80px;">
<strong>end if</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 60px;">
<strong>end for</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 40px;">
<strong>end procedure</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 40px;">
<strong>Procedure</strong> Swap()
</td>
</tr>
<tr>
<td style="border: none; padding-left: 60px;">
generate <span class="math inline">\(m =\)</span> random integer on <span class="math inline">\([1, M - 1]\)</span>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 60px;">
generate <span class="math inline">\(u' \sim U([0,1])\)</span>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 60px;">
<strong>if</strong> <span class="math inline">\(u' \leq \frac{f(X_{i,m})^{1/T_{m+1}}f(X_{i,m+1})^{1/T_{m}}}{f(X_{i,m})^{1/T_m}f(X_{i,m+1})^{1/T_{m+1}}}\)</span> <strong>then</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 80px;">
exchange <span class="math inline">\(X_{i,m}\)</span> and <span class="math inline">\(X_{i,m+1}\)</span>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 60px;">
<strong>end if</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 40px;">
<strong>end procedure</strong>
</td>
</tr>
<tr>
<td style="border: none; padding-left: 20px;">
<strong>end for</strong>
</td>
</tr>
<tr>
<td style="border: none;">
<strong>end procedure</strong>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-q1c-traceplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q1c-traceplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-q1c-traceplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q1c-traceplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: A traceplot for the Parallel Tempering sampler, run for <span class="math inline">\(n=200,000\)</span> iterations on <span class="math inline">\(M=5\)</span> chains with <span class="math inline">\(\mathbf{T}=(1, 5, 7, 10, 15)\)</span>, <span class="math inline">\(\sigma = (0.5, 0.7, 0.8, 0.9, 1)\)</span>, and <span class="math inline">\(\mathbf{X_0}=(15,15,15,15,15)\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="comparison-of-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="comparison-of-algorithms">Comparison of Algorithms</h2>
<div class="cell">
<div id="tbl-q1d" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-q1d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Comparison of Effective Sample Sizes (ESS) of the three algorithms, each run on <span class="math inline">\(n=200,000\)</span> iterations.
</figcaption>
<div aria-describedby="tbl-q1d-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">RWMH</th>
<th style="text-align: right;">Variable-Transformed</th>
<th style="text-align: right;">Parallel Tempering</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ESS (raw)</td>
<td style="text-align: right;">92.3961335</td>
<td style="text-align: right;">432.174053</td>
<td style="text-align: right;">3607.244938</td>
</tr>
<tr class="even">
<td style="text-align: left;">ESS (%)</td>
<td style="text-align: right;">0.0461981</td>
<td style="text-align: right;">0.216087</td>
<td style="text-align: right;">1.803622</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The algorithm in part (a) was able to reach convergence to the stationary distribution, but only with a very large variance in the random noise. This caused problematic levels of autocorrelation, indicating very slow mixing and thus poor mixing quality, as evidenced by its having the lowest effective sample size of the three algorithms (see <a href="#tbl-q1d" class="quarto-xref">Table&nbsp;1</a>). It is relatively computationally inexpensive, as it only requires one chain, but its low effective sample size means it would require a very high number of iterations to sample widely from the distribution.</p>
<p>The algorithm in part (b) was able to reach convergence at a lower, but still problematic, level of <span class="math inline">\(\sigma\)</span>. We see in <a href="#fig-q1d-acf-1" class="quarto-xref">Figure&nbsp;6 (a)</a> that the sample autocorrelation function only takes a lag of a few hundred observations (as opposed to a few thousand in <a href="#fig-q1a-acf" class="quarto-xref">Figure&nbsp;3</a>) to decay to 0, but this is still quite large. The effect of this slower decay rate can be seen in the sampler’s effective sample size, shown in <a href="#tbl-q1d" class="quarto-xref">Table&nbsp;1</a>. Overall, though the mixing quality is better than the sampler from part (a), it is still not exceptional. However, this algorithm is the least computationally expensive, as it only proposes samples that are in the support of <span class="math inline">\(f\)</span>, automatically leading to a larger effective sample size than the sampler in part (a), and thus requiring fewer iterations to converge.</p>
<div class="cell" data-layout="[[45,-10,45]]">
<div id="fig-q1d-acf" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-q1d-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-q1d-acf" style="flex-basis: 45.0%;justify-content: flex-start;">
<div id="fig-q1d-acf-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-q1d-acf-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-q1d-acf-1.png" class="img-fluid figure-img" data-ref-parent="fig-q1d-acf" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-q1d-acf-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) truncated RWMH (part (b))
</figcaption>
</figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-q1d-acf" style="flex-basis: 45.0%;justify-content: flex-start;">
<div id="fig-q1d-acf-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-q1d-acf-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-q1d-acf-2.png" class="img-fluid figure-img" data-ref-parent="fig-q1d-acf" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-q1d-acf-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) parallel tempering (part (c))
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-q1d-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Autocorrelation of the samples generated from the algorithms in parts (b) and (c).
</figcaption>
</figure>
</div>
</div>
<p>Finally, the algorithm constructed in part (c) wins in terms of convergence and mixing quality. It is able to explore the entire distribution well, as shown in <a href="#fig-q1c-traceplot" class="quarto-xref">Figure&nbsp;5</a>. Furthermore, we can see in <a href="#fig-q1d-acf-2" class="quarto-xref">Figure&nbsp;6 (b)</a> that the autocorrelation times are largely reduced compared to the algorithms from (a) and (b). However, it should be noted that the autocorrelation function never fully approaches 0, but rather converges to a positive value quickly. Nevertheless, the parallel tempering algorithm still has mixing quality, corresponding to a much larger effective sample size, shown in <a href="#tbl-q1d" class="quarto-xref">Table&nbsp;1</a>. The downside of this algorithm is that it is by far the most computationally expensive, seeing as it requires 5 parallel chains instead of 1.</p>
</section>
<section id="confidence-intervals-using-mcmc-samplers" class="level2">
<h2 class="anchored" data-anchor-id="confidence-intervals-using-mcmc-samplers">Confidence Intervals using MCMC Samplers</h2>
<p>Let us now estimate <span class="math inline">\(\mathbb{E}(X)\)</span> where <span class="math inline">\(X\)</span> is a random variable with density <span class="math inline">\(f\)</span>. Let <span class="math inline">\(\hat I^{(a)}_n, \hat I^{(b)}_n, \hat I^{(c)}_n\)</span> denote the estimate of <span class="math inline">\(\mathbb{E}(X)\)</span> generated by the MCMC algorithms detailed in parts (a), (b), and (c), respectively, run for <span class="math inline">\(n\)</span> iterations.</p>
<p>We would like to find 95% confidence intervals for each <span class="math inline">\(\hat I_n\)</span>, at varying values of <span class="math inline">\(n\)</span>. I generated confidence intervals for <span class="math inline">\(1,000\leq n\leq 100,000\)</span>, increasing <span class="math inline">\(n\)</span> by <span class="math inline">\(100\)</span> on each iteration. Thus, we have <span class="math inline">\(k=1000\)</span> batches with a batch size of <span class="math inline">\(m=100\)</span>. We note that these confidence intervals take the form <span class="math display">\[
\hat I_n \pm t_{1-\delta/2}\frac{s_m(n)}{\sqrt{n}} = \hat I_n \pm t_{0.975}\sqrt{\frac{\frac{1}{99}\sum_{k=1}^{1000}(\hat I_{k,n}-\hat I_n)^2}{1000}}
\]</span> where <span class="math inline">\(\hat I_{k,n}=\frac{100}{n}\sum_{i=999n/100}^{1000n/100}X_i\)</span> is the <span class="math inline">\(k\)</span>th batch mean and <span class="math inline">\(t_{1-\delta/2}\)</span> denotes the quantile of <span class="math inline">\(1-\delta/2\)</span> of a Student’s <span class="math inline">\(t\)</span>-distribution with <span class="math inline">\(m-1=99\)</span> degrees of freedom. To generate the plots of these CIs for increasing <span class="math inline">\(n\)</span>, however, I did not calculate each upper and lower bound by hand. I used the <code>mcse</code> function from the <code>mcmcse</code> package and <code>qt</code> from base R. The results are included in <a href="#fig-confints" class="quarto-xref">Figure&nbsp;7</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-confints" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-confints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="csmlexam-mcmc_files/figure-html/fig-confints-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-confints-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Estimates of <span class="math inline">\(\mathbb E(X)\)</span> for chains of length <span class="math inline">\(n\in \{100,200,\dots, 200,000\}\)</span> generated by the algorithms built in parts (a), (b), and (c). The gray shading denotes the 95% confidence intervals for <span class="math inline">\(\hat I_n\)</span>. The value of <span class="math inline">\(\mathbb{E}(X)\)</span> found via numerical integration is included as the dashed line.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plots in <a href="#fig-confints" class="quarto-xref">Figure&nbsp;7</a> are somewhat dependent on seed, but their behaviour is generalisable. The RWMH algorithm only consistently approaches the true value of <span class="math inline">\(\mathbb E(X)\)</span> for large <span class="math inline">\(n\)</span>, either over- or under-estimating this value beforehand. The variable-transformed and parallel tempering algorithms both converge near the true value of <span class="math inline">\(\mathbb E (X)\)</span> for smaller <span class="math inline">\(n\)</span>. Between the latter two, the variable-transformed algorithm tends to converge faster than parallel tempering, but has wider confidence intervals. The parallel tempering has the smallest confidence intervals, but these do not always include the true value of <span class="math inline">\(\mathbb E(X)\)</span>. Thus, for confidence intervals, I would choose the variable-transformed algorithm over the other two.</p>
</section>
<section id="sec-code" class="level2">
<h2 class="anchored" data-anchor-id="sec-code">Code Appendix</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Document setup</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dev =</span> <span class="st">"ragg_png"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 1</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># part (a)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># target:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">exp</span>(<span class="sc">-</span><span class="dv">3</span><span class="sc">*</span>(x<span class="dv">-2</span>)) <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>(x<span class="dv">-30</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>(x<span class="dv">-20</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>.<span class="dv">01</span>)) <span class="sc">*</span> <span class="fu">as.numeric</span>(x<span class="sc">&gt;=</span><span class="dv">2</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># random walk:</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>rwproposal <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sigma, X0){</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  Xres <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> X0</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    Y <span class="ot">&lt;-</span> X <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;=</span> <span class="fu">f</span>(Y)<span class="sc">/</span><span class="fu">f</span>(X)){</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      X <span class="ot">&lt;-</span> Y</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    Xres[i] <span class="ot">&lt;-</span> X</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Xres)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="fl">2e5</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>X5 <span class="ot">&lt;-</span> <span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="fl">0.5</span>, <span class="at">X0 =</span> <span class="dv">5</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>X15 <span class="ot">&lt;-</span> <span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="fl">0.5</span>, <span class="at">X0 =</span> <span class="dv">15</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>X20 <span class="ot">&lt;-</span> <span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="fl">0.5</span>, <span class="at">X0 =</span> <span class="dv">20</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>X25 <span class="ot">&lt;-</span> <span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="fl">0.5</span>, <span class="at">X0 =</span> <span class="dv">25</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>Xvar <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X5 =</span> X5, <span class="at">X15 =</span> X15, <span class="at">X20 =</span> X20, <span class="at">X25 =</span> X25,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span>sample_size) <span class="sc">%&gt;%</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"X"</span>),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"startval"</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"X"</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"X"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">startval =</span> <span class="fu">fct_relevel</span>(startval, <span class="fu">c</span>(<span class="st">"25"</span>,<span class="st">"20"</span>,<span class="st">"15"</span>,<span class="st">"5"</span>)))</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Xvar, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> X, <span class="at">color =</span> startval)) <span class="sc">+</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Index"</span>, <span class="at">y =</span> <span class="st">"X"</span>, <span class="at">color =</span> <span class="st">"Initial X value"</span>) <span class="sc">+</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>))</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>X0s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">2</span>,<span class="dv">20</span>,<span class="dv">30</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>chains1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X0s, </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x0) <span class="fu">mcmc</span>(<span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="dv">1</span>, <span class="at">X0 =</span> x0)))</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>chains2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X0s, </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x0) <span class="fu">mcmc</span>(<span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="dv">2</span>, <span class="at">X0 =</span> x0)))</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>chains3 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X0s, </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x0) <span class="fu">mcmc</span>(<span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="dv">3</span>, <span class="at">X0 =</span> x0)))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>chains4 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X0s, </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x0) <span class="fu">mcmc</span>(<span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="dv">4</span>, <span class="at">X0 =</span> x0)))</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>chains5 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X0s, </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x0) <span class="fu">mcmc</span>(<span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="dv">5</span>, <span class="at">X0 =</span> x0)))</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>chains6 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X0s, </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x0) <span class="fu">mcmc</span>(<span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="dv">6</span>, <span class="at">X0 =</span> x0)))</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>chains1 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains1)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>chains2 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains2)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>chains3 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains3)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>chains4 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains4)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>chains5 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains5)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>chains6 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains6)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(chains1, <span class="at">auto.layout =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(chains2, <span class="at">auto.layout =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(chains3, <span class="at">auto.layout =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="dv">3</span>))</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(chains4, <span class="at">auto.layout =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="dv">4</span>))</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(chains5, <span class="at">auto.layout =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="dv">5</span>))</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(chains6, <span class="at">auto.layout =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="fu">expression</span>(sigma <span class="sc">==</span> <span class="dv">6</span>))</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>standard_mcmc_sample <span class="ot">&lt;-</span> <span class="fu">rwproposal</span>(<span class="at">n =</span> sample_size, <span class="at">sigma =</span> <span class="dv">6</span>, <span class="at">X0 =</span> <span class="dv">15</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(standard_mcmc_sample, <span class="at">type =</span> <span class="st">"correlation"</span>,</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag.max =</span> <span class="dv">10000</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="co"># part (b)</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>ftrans <span class="ot">&lt;-</span> <span class="cf">function</span>(y) <span class="fu">f</span>(<span class="fu">exp</span>(y)<span class="sc">+</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">exp</span>(y)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="co"># random walk:</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>rwtransform <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sigma, Y0){</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  Ysamp <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  Ysamp[<span class="dv">1</span>] <span class="ot">&lt;-</span> Y0</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> Y0</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    Yproposal <span class="ot">&lt;-</span> Y <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;=</span> <span class="fu">ftrans</span>(Yproposal)<span class="sc">/</span><span class="fu">ftrans</span>(Y)){</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>      Y <span class="ot">&lt;-</span> Yproposal</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    Ysamp[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> Y</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  Xsamp <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">exp</span>(Ysamp)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Xsamp)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="co"># results:</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="co"># need a starting Y value not X value!</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>xtransform <span class="ot">&lt;-</span> <span class="fu">rwtransform</span>(sample_size, <span class="at">sigma =</span> <span class="dv">2</span>, <span class="at">Y0 =</span> <span class="fu">log</span>(<span class="dv">13</span>))</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>trceplt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(xtransform),</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>                      <span class="at">X =</span> xtransform)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trceplt, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> X)) <span class="sc">+</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>))</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="co"># part (c)</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>paralleltemp <span class="ot">&lt;-</span> <span class="cf">function</span>(iterations, Ts, sigmas, X0) {</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">length</span>(Ts)</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span>iterations<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> M)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  X[<span class="dv">1</span>,] <span class="ot">&lt;-</span> X0</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iterations) {</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we are going to do a x-step; use log-domain for underflow issues</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>      X[n<span class="sc">+</span><span class="dv">1</span>, i] <span class="ot">&lt;-</span> X[n, i]</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>      Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, X[n,i], sigmas[i])</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> <span class="fu">exp</span>((<span class="dv">1</span><span class="sc">/</span>Ts[i])<span class="sc">*</span>(<span class="fu">log</span>(<span class="fu">f</span>(Y))<span class="sc">-</span><span class="fu">log</span>(<span class="fu">f</span>(X[n,i]))))</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(alpha) <span class="sc">&amp;&amp;</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;=</span> alpha){</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>        X[n<span class="sc">+</span><span class="dv">1</span>, i] <span class="ot">&lt;-</span> Y</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we are going for a swap</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>(M<span class="dv">-1</span>), <span class="dv">1</span>)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    num <span class="ot">&lt;-</span> (<span class="fu">f</span>(X[n<span class="sc">+</span><span class="dv">1</span>,m])<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>Ts[m<span class="sc">+</span><span class="dv">1</span>])<span class="sc">*</span><span class="fu">f</span>(X[n<span class="sc">+</span><span class="dv">1</span>,m<span class="sc">+</span><span class="dv">1</span>])<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>Ts[m]))</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    denom <span class="ot">&lt;-</span> (<span class="fu">f</span>(X[n<span class="sc">+</span><span class="dv">1</span>,m])<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>Ts[m])<span class="sc">*</span><span class="fu">f</span>(X[n<span class="sc">+</span><span class="dv">1</span>,m<span class="sc">+</span><span class="dv">1</span>])<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>Ts[m<span class="sc">+</span><span class="dv">1</span>]))</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># log1 &lt;- (1/Ts[m+1])*log(f(X[n+1,m]))</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;=</span> num<span class="sc">/</span>denom){</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>      store <span class="ot">&lt;-</span> X[n<span class="sc">+</span><span class="dv">1</span>,m<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>      X[n<span class="sc">+</span><span class="dv">1</span>,m<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> X[n<span class="sc">+</span><span class="dv">1</span>,m]</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>      X[n<span class="sc">+</span><span class="dv">1</span>,m] <span class="ot">&lt;-</span> store</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(X)</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>Ts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">15</span>)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span>,<span class="dv">1</span>)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>X0s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">paralleltemp</span>(sample_size, Ts, sigmas, <span class="at">X0 =</span> X0s)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>parallel_sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample =</span> samples[,<span class="dv">1</span>],</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>                               <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(samples[,<span class="dv">1</span>]))</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parallel_sample, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> sample)) <span class="sc">+</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>))</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>ess <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="fu">effectiveSize</span>(<span class="fu">mcmc</span>(standard_mcmc_sample)),</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>                        <span class="at">b =</span> <span class="fu">effectiveSize</span>(<span class="fu">mcmc</span>(xtransform)),</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>                        <span class="at">c =</span> <span class="fu">effectiveSize</span>(<span class="fu">mcmc</span>(samples[,<span class="dv">1</span>]))) <span class="sc">%&gt;%</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">a =</span> <span class="fu">effectiveSize</span>(<span class="fu">mcmc</span>(standard_mcmc_sample))<span class="sc">/</span>sample_size<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>          <span class="at">b =</span> <span class="fu">effectiveSize</span>(<span class="fu">mcmc</span>(xtransform))<span class="sc">/</span>sample_size<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>          <span class="at">c =</span> <span class="fu">effectiveSize</span>(<span class="fu">mcmc</span>(samples[,<span class="dv">1</span>]))<span class="sc">/</span>sample_size<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ess) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ESS (raw)"</span>, <span class="st">"ESS (%)"</span>)</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(ess,</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"RWMH"</span>,</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Variable-Transformed"</span>,</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Parallel Tempering"</span>))</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(xtransform, <span class="at">type =</span> <span class="st">"correlation"</span>, <span class="at">lag.max =</span> <span class="dv">1000</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(samples[,<span class="dv">1</span>], <span class="at">type =</span> <span class="st">"correlation"</span>, <span class="at">lag.max =</span> <span class="dv">1000</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mcmcse)</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rwproposal</span>(sample_size, <span class="at">sigma =</span> <span class="dv">6</span>, <span class="at">X0 =</span> <span class="dv">15</span>)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rwtransform</span>(sample_size, <span class="at">sigma =</span> <span class="dv">2</span>, <span class="at">Y0 =</span> <span class="fu">log</span>(<span class="dv">13</span>))</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">paralleltemp</span>(sample_size, Ts, sigmas, X0s)[,<span class="dv">1</span>]</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1000</span>, <span class="dv">100000</span>, <span class="at">by =</span> <span class="dv">100</span>)</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>confints_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">length</span>(N))</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(N)){</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> N[j]</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  asamp <span class="ot">&lt;-</span> a[<span class="dv">1</span><span class="sc">:</span>i]</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>  bsamp <span class="ot">&lt;-</span> b[<span class="dv">1</span><span class="sc">:</span>i]</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  csamp <span class="ot">&lt;-</span> c[<span class="dv">1</span><span class="sc">:</span>i]</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>  ase <span class="ot">&lt;-</span> <span class="fu">mcse</span>(asamp, <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>  bse <span class="ot">&lt;-</span> <span class="fu">mcse</span>(bsamp, <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>  cse <span class="ot">&lt;-</span> <span class="fu">mcse</span>(csamp, <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>  ta <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> <span class="dv">99</span>)</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  tb <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> <span class="dv">99</span>)</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  tc <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> <span class="dv">99</span>)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">n =</span> <span class="fu">rep</span>(i, <span class="dv">3</span>),</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alg =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lower =</span> <span class="fu">c</span>(ase<span class="sc">$</span>est <span class="sc">-</span> ta<span class="sc">*</span>ase<span class="sc">$</span>se,</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>                               bse<span class="sc">$</span>est <span class="sc">-</span> tb<span class="sc">*</span>bse<span class="sc">$</span>se,</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>                               cse<span class="sc">$</span>est <span class="sc">-</span> tc<span class="sc">*</span>cse<span class="sc">$</span>se),</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>                     <span class="at">est =</span> <span class="fu">c</span>(ase<span class="sc">$</span>est, bse<span class="sc">$</span>est, cse<span class="sc">$</span>est),</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>                     <span class="at">upper =</span> <span class="fu">c</span>(ase<span class="sc">$</span>est <span class="sc">+</span> ta<span class="sc">*</span>ase<span class="sc">$</span>se,</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>                               bse<span class="sc">$</span>est <span class="sc">+</span> tb<span class="sc">*</span>bse<span class="sc">$</span>se,</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>                               cse<span class="sc">$</span>est <span class="sc">+</span> tc<span class="sc">*</span>cse<span class="sc">$</span>se))</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>  confints_list[[j]] <span class="ot">&lt;-</span> df</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>confints <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(confints_list)</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>normalise <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(x) <span class="fu">f</span>(x), <span class="at">lower =</span> <span class="dv">2</span>, <span class="at">upper =</span> <span class="cn">Inf</span>)</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>expectation <span class="ot">&lt;-</span> <span class="fu">integrate</span>(<span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>normalise<span class="sc">$</span>value<span class="sc">*</span><span class="fu">f</span>(x)<span class="sc">*</span>x, <span class="at">lower =</span> <span class="dv">2</span>,</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>                         <span class="at">upper =</span> <span class="cn">Inf</span>)</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">subset</span>(confints, alg <span class="sc">==</span> <span class="st">"a"</span>), <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> expectation<span class="sc">$</span>value, <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"navy"</span>) <span class="sc">+</span> </span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">round</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>, expectation<span class="sc">$</span>value),</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">digits =</span> <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(n),</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(I[n])<span class="sc">^</span>{(a)})) <span class="sc">+</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>),</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">subset</span>(confints, alg <span class="sc">==</span> <span class="st">"b"</span>), <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> expectation<span class="sc">$</span>value, <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"navy"</span>) <span class="sc">+</span> </span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">round</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>, expectation<span class="sc">$</span>value),</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">digits =</span> <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(n),</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(I[n])<span class="sc">^</span>{(b)})) <span class="sc">+</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>),</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">subset</span>(confints, alg <span class="sc">==</span> <span class="st">"c"</span>), <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> expectation<span class="sc">$</span>value, <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"navy"</span>) <span class="sc">+</span> </span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">round</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>, expectation<span class="sc">$</span>value),</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">digits =</span> <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(n),</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(I[n])<span class="sc">^</span>{(c)})) <span class="sc">+</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>),</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>a1 <span class="sc">/</span> a2 <span class="sc">/</span> a3</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>